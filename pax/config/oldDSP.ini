##
# Jinx Is Not Xerawdp
# But tries to get as close as we can
##


[pax]
parent_configuration = ["XENON100"]

dsp = [
       'BuildWaveforms.BuildWaveforms',
       'Filtering.Filtering',
       'OldPeakFinder.FindPeaksXeRawDPStyle',
       'OldPeakFinder.ComputePeakPropertiesXdpStyle', # Area and entropy, also prunes excess S1s
       ]



[BuildWaveforms.BuildWaveforms]
reuse_baseline_for_adjacent_occurrences = True
rear_baselining_for_short_occurrences = True
rear_baselining_threshold_occurrence_length = 92
zombie_paranoia = False  # If True, will warn you if a dead channel (gain=0) shows a signal

# If this is true, special sum waveforms are made were only the nominal gain is used for correction
# Use only for Xerawdp matching
xerawdp_matching = True

[Filtering.Filtering]
filters = (
        {'name' : 'filtered_for_large_s2',  'source' : 'uS2',  'impulse_response' : (
            0.005452,  0.009142,  0.013074,  0.017179,  0.021381,  0.025597,  0.029746,  0.033740,  0.037499,
            0.040941,  0.043992,  0.046586,  0.048666,  0.050185,  0.051111,  0.051422,  0.051111,  0.050185,
            0.048666,  0.046586,  0.043992,  0.040941,  0.037499,  0.033740,  0.029746,  0.025597,  0.021381,
            0.017179,  0.013074,  0.009142,  0.005452
        )},
        {'name' : 'filtered_for_small_s2',  'source' : 'uS2',  'impulse_response' : (
            0, 0.0053657, 0.0193269, 0.0359971, 0.0486039, 0.0520942, 0.0520942, 0.0520942, 0.0520942, 0.0520942,
            0.0520942, 0.0520942, 0.0520942, 0.0520942, 0.0520942, 0.0520942, 0.0520942, 0.0520942, 0.0520942,
            0.0520942, 0.0486039, 0.0359971, 0.0193269, 0.0053657, 0
        )},
        {'name' : 'filtered_for_s1_width_test',  'source' : 'uS1',  'impulse_response' : (
            0.005452,  0.009142,  0.013074,  0.017179,  0.021381,  0.025597,  0.029746,  0.033740,  0.037499,
            0.040941,  0.043992,  0.046586,  0.048666,  0.050185,  0.051111,  0.051422,  0.051111,  0.050185,
            0.048666,  0.046586,  0.043992,  0.040941,  0.037499,  0.033740,  0.029746,  0.025597,  0.021381,
            0.017179,  0.013074,  0.009142,  0.005452
        )},
    )


# Turn on only for Xerawdp matching
# Doesn't work well with simulated waveforms, unless you add some noise to them
simulate_Xerawdp_convolution_bug = True


[OldPeakFinder]
# Prune peaks beyond the 32 primary S1 and S2s
# Deactivate for simulated waveform testing with large aggregate events!
prune_peaks = True

[OldPeakFinder.ComputePeakPropertiesXdpStyle]
# Minimum area seen in a PMT to count towards the coincidence level
coincidence_threshold = 0.35  #pe


[Plotting]
# Internal names and plot labels of the summed waveforms you want to see plotted
waveforms_to_plot = (
        {  'internal_name': 'uS2',
           'plot_label': '  TPC (raw)',
           'drawstyle':     'steps',
        },
        {  'internal_name': 'filtered_for_large_s2',
           'plot_label':    'TPC (filtered for s2)',
        },
        {  'internal_name': 'veto',
           'plot_label':    'Veto (raw)',
           'drawstyle':     'steps',
        },
    )


[DEFAULT]
# The PMTs below are excluded when peakfinding and computing the areas/widths etc of S1s.
# This has no effect on S2s; the only way to fully disable a channel is to set its gain to 0.
#
# TEMP for XerawDP matching: we need the uncorrected waveform for peakfinding,
# which is only available in JoinAndConvertWaveforms, so it is computed there.
channels_excluded_for_s1 = set([1, 2, 145, 148, 157, 171, 177])


# PMT gains taken from gain database (around 20120402?)
# These should be the ones used to process the 120402 XED file
gains = { 0:0, 1: 2715400, 2: 2875650, 3: 1941550, 4: 2068200, 5: 1886150, 6: 1868400, 7: 2152300, 8: 1906050,
          9: 0, 10: 2055000, 11: 1930250, 12: 0, 13: 1965000, 14: 2111900, 15: 2169650, 16: 2219450, 17: 2096400,
          18: 2097900, 19: 2108850, 20: 2092000, 21: 1989150, 22: 2040950, 23: 1637300, 24: 1945750, 25: 2170050,
          26: 2192580, 27: 1982450, 28: 1942100, 29: 2237050, 30: 2152150, 31: 2222250, 32: 2216050, 33: 1335300,
          34: 2068850, 35: 2079500, 36: 2141900, 37: 2046050, 38: 2008500, 39: 0, 40: 2060950, 41: 1943350,
          42: 1855350, 43: 2057200, 44: 2000850, 45: 1934950, 46: 2178750, 47: 2024650, 48: 2068700, 49: 2155750,
          50: 2110050, 51: 2144400, 52: 1941400, 53: 2114150, 54: 2051850, 55: 2215000, 56: 2081950, 57: 2165650,
          58: 0, 59: 2260550, 60: 2156850, 61: 2048350, 62: 2087100, 63: 1966400, 64: 2221700, 65: 2099600,
          66: 2133950, 67: 2048450, 68: 2146666, 69: 2206800, 70: 2231100, 71: 2145450, 72: 2231700, 73: 2199000,
          74: 2051600, 75: 1968400, 76: 2069050, 77: 1978400, 78: 1949900, 79: 2088250, 80: 2228600, 81: 2172150,
          82: 1985350, 83: 2095200, 84: 1955900, 85: 1883350, 86: 1978250, 87: 2121750, 88: 1836000, 89: 2123250,
          90: 2026111, 91: 2272600, 92: 2215750, 93: 2152050, 94: 1915650, 95: 1877750, 96: 2345450, 97: 2164900,
          98: 1954600, 99: 1856200, 100: 0, 101: 1957500, 102: 2281000, 103: 1999400, 104: 1909750, 105: 0,
          106: 1732550, 107: 2112500, 108: 1915900, 109: 2013850, 110: 2123900, 111: 1961950, 112: 1821350,
          113: 1899500, 114: 1808000, 115: 2129950, 116: 2012450, 117: 1941950, 118: 2053850, 119: 2005100,
          120: 1991250, 121: 1830500, 122: 1952150, 123: 2002750, 124: 2108100, 125: 1940100, 126: 1954250,
          127: 1969100, 128: 2188000, 129: 2142850, 130: 2057600, 131: 2209300, 132: 2144350, 133: 2033300,
          134: 1932400, 135: 1966950, 136: 1973500, 137: 1897850, 138: 2088700, 139: 1663000, 140: 2242900,
          141: 1717450, 142: 1956350, 143: 1894600, 144: 1898050, 145: 1677300, 146: 1996350, 147: 1811250,
          148: 1672200, 149: 1890050, 150: 2103400, 151: 1672650, 152: 1969150, 153: 2161000, 154: 1774550,
          155: 1932550, 156: 1813000, 157: 1938070, 158: 2020900, 159: 2047600, 160: 1821350, 161: 1791450,
          162: 1720900, 163: 2051950, 164: 1903850, 165: 1801900, 166: 1995750, 167: 1550250, 168: 1200800,
          169: 1896100, 170: 2005250, 171: 2022750, 172: 1835500, 173: 1922250, 174: 1948900, 175: 2090300,
          176: 1910550, 177: 0, 178: 1831350, 179: 2012100, 180: 2074300, 181: 2502050, 182: 1339200,
          183: 1814200, 184: 1895530, 185: 1975050, 186: 2047850, 187: 1946850, 188: 2144300, 189: 2000100,
          190: 2017750, 191: 0, 192: 1942150, 193: 2117550, 194: 1529950, 195: 0, 196: 1923750, 197: 1749050,
          198: 1940300, 199: 1971950, 200: 1919150, 201: 1888400, 202: 2184450, 203: 2163800, 204: 1983700,
          205: 2010900, 206: 2055700, 207: 1984900, 208: 2045150, 209: 2132550, 210: 1791500, 211: 2050600,
          212: 2000600, 213: 2039950, 214: 1831400, 215: 2035350, 216: 1759010, 217: 2062300, 218: 2111100,
          219: 1945900, 220: 1973750, 221: 2177800, 222: 1914600, 223: 1981400, 224: 0, 225: 1994150, 226: 2069750,
          227: 2201250, 228: 2069300, 229: 1964850, 230: 1938750, 231: 1972100, 232: 1869500, 233: 1995650,
          234: 2149150, 235: 0, 236: 2113400, 237: 1804800, 238: 1921700, 239: 1805550, 240: 1898200, 241: 1893470,
          242: 190140
          }
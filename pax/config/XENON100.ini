##
# XENON100-specific configuration settings
##


# This is just for setting up pax
[pax]
parent_configuration = "_base"    # Inherit settings from default.ini

# Digital signal processing to imitate Xerawdp
dsp = [
       'BuildWaveforms.BuildWaveforms',
       'Filtering.Filtering',
       'PeakFinding.FindPeaksXeRawDPStyle',
       'PeakFinding.ComputePeakProperties',
       ]


# Global settings, passed to every plugin
[DEFAULT]
tpc_name = "XENON100"

# Remember python range does not include endpoint!
# Remember python3 range does not return a list;
# have to encapsulate it in set() to be able to | these
# Could have used list and +, but easier to subtract excluded pmts this way
# This is pretty arcane python stuff to put in a config file...!
# TODO: There should be a more intelligent way to do this
pmts_top = set(range(1,  98 + 1))
pmts_bottom = set(range(99, 178 + 1))
pmts_veto = set(range(179, 242 + 1))

# The PMTs below are excluded when peakfinding and computing the areas/widths etc of S1s.
# This has no effect on S2s; the only way to fully disable a channel is to set its gain to 0.
#
# TEMP for XerawDP matching: we need the uncorrected waveform for peakfinding,
# which is only available in JoinAndConvertWaveforms, so it is computed there.
pmts_excluded_for_s1 = set([1, 2, 145, 148, 157, 171, 177])

# PMT locations taken from Marc Schumann's pmtpattern code.  Agrees also
# with the top PMT locations used by xerawdp.
pmt_locations =   { 0 : {'x' : 0, 'y' : 0},
                    1 : {'x' : 166.84, 'y' : 0.00},	2 : {'x' : 163.19, 'y' : 34.69},
                    3 : {'x' : 152.42, 'y' : 67.86},	4 : {'x' : 134.98, 'y' : 98.07},
                    5 : {'x' : 111.64, 'y' : 123.99},	6 : {'x' : 83.42, 'y' : 144.49},
                    7 : {'x' : 51.56, 'y' : 158.67},	8 : {'x' : 17.44, 'y' : 165.93},
                    9 : {'x' : -17.44, 'y' : 165.93},	10 : {'x' : -51.56, 'y' : 158.67},
                    11 : {'x' : -83.42, 'y' : 144.49},	12 : {'x' : -111.64, 'y' : 123.99},
                    13 : {'x' : -134.98, 'y' : 98.07},	14 : {'x' : -152.42, 'y' : 67.86},
                    15 : {'x' : -163.19, 'y' : 34.69},	16 : {'x' : -166.84, 'y' : 0.00},
                    17 : {'x' : -163.19, 'y' : -34.69},	18 : {'x' : -152.42, 'y' : -67.86},
                    19 : {'x' : -134.98, 'y' : -98.07},	20 : {'x' : -111.64, 'y' : -123.99},
                    21 : {'x' : -83.42, 'y' : -144.49},	22 : {'x' : -51.56, 'y' : -158.67},
                    23 : {'x' : -17.44, 'y' : -165.93},	24 : {'x' : 17.44, 'y' : -165.93},
                    25 : {'x' : 51.56, 'y' : -158.67},	26 : {'x' : 83.42, 'y' : -144.49},
                    27 : {'x' : 111.64, 'y' : -123.99},	28 : {'x' : 134.98, 'y' : -98.07},
                    29 : {'x' : 152.42, 'y' : -67.86},	30 : {'x' : 163.19, 'y' : -34.69},
                    31 : {'x' : 136.53, 'y' : 0.00},	32 : {'x' : 131.88, 'y' : 35.34},
                    33 : {'x' : 118.24, 'y' : 68.27},	34 : {'x' : 96.54, 'y' : 96.54},
                    35 : {'x' : 68.27, 'y' : 118.24},	36 : {'x' : 35.34, 'y' : 131.88},
                    37 : {'x' : 0.00, 'y' : 136.53},	38 : {'x' : -35.34, 'y' : 131.88},
                    39 : {'x' : -68.27, 'y' : 118.24},	40 : {'x' : -96.54, 'y' : 96.54},
                    41 : {'x' : -118.24, 'y' : 68.27},	42 : {'x' : -131.88, 'y' : 35.34},
                    43 : {'x' : -136.53, 'y' : 0.00},	44 : {'x' : -131.88, 'y' : -35.34},
                    45 : {'x' : -118.24, 'y' : -68.27},	46 : {'x' : -96.54, 'y' : -96.54},
                    47 : {'x' : -68.27, 'y' : -118.24},	48 : {'x' : -35.34, 'y' : -131.88},
                    49 : {'x' : -0.00, 'y' : -136.53},	50 : {'x' : 35.34, 'y' : -131.88},
                    51 : {'x' : 68.27, 'y' : -118.24},	52 : {'x' : 96.54, 'y' : -96.54},
                    53 : {'x' : 118.24, 'y' : -68.27},	54 : {'x' : 131.88, 'y' : -35.34},
                    55 : {'x' : 106.20, 'y' : 0.00},	56 : {'x' : 101.00, 'y' : 32.82},
                    57 : {'x' : 85.92, 'y' : 62.42},	58 : {'x' : 62.42, 'y' : 85.92},
                    59 : {'x' : 32.82, 'y' : 101.00},	60 : {'x' : 0.00, 'y' : 106.20},
                    61 : {'x' : -32.82, 'y' : 101.00},	62 : {'x' : -62.42, 'y' : 85.92},
                    63 : {'x' : -85.92, 'y' : 62.42},	64 : {'x' : -101.00, 'y' : 32.82},
                    65 : {'x' : -106.20, 'y' : 0.00},	66 : {'x' : -101.00, 'y' : -32.82},
                    67 : {'x' : -85.92, 'y' : -62.42},	68 : {'x' : -62.42, 'y' : -85.92},
                    69 : {'x' : -32.82, 'y' : -101.00},	70 : {'x' : -0.00, 'y' : -106.20},
                    71 : {'x' : 32.82, 'y' : -101.00},	72 : {'x' : 62.42, 'y' : -85.92},
                    73 : {'x' : 85.92, 'y' : -62.42},	74 : {'x' : 101.00, 'y' : -32.82},
                    75 : {'x' : 75.87, 'y' : 0.00},	76 : {'x' : 68.76, 'y' : 32.06},
                    77 : {'x' : 47.75, 'y' : 58.96},	78 : {'x' : 17.07, 'y' : 73.93},
                    79 : {'x' : -15.77, 'y' : 74.21},	80 : {'x' : -46.71, 'y' : 59.79},
                    81 : {'x' : -68.19, 'y' : 33.26},	82 : {'x' : -75.87, 'y' : 0.00},
                    83 : {'x' : -68.76, 'y' : -32.06},	84 : {'x' : -47.75, 'y' : -58.96},
                    85 : {'x' : -17.07, 'y' : -73.93},	86 : {'x' : 15.77, 'y' : -74.21},
                    87 : {'x' : 46.71, 'y' : -59.79},	88 : {'x' : 68.19, 'y' : -33.26},
                    89 : {'x' : 45.00, 'y' : 0.00},	90 : {'x' : 30.00, 'y' : 30.00},
                    91 : {'x' : -0.00, 'y' : 45.00},	92 : {'x' : -30.00, 'y' : 30.00},
                    93 : {'x' : -45.00, 'y' : 0.00},	94 : {'x' : -30.00, 'y' : -30.00},
                    95 : {'x' : -0.00, 'y' : -45.00},	96 : {'x' : 30.00, 'y' : -30.00},
                    97 : {'x' : 15.00, 'y' : 0.00},	98 : {'x' : -15.00, 'y' : 0.00},
                    99 : {'x' : -41.15, 'y' : 123.44},	100 : {'x' : -13.71, 'y' : 123.44},
                    101 : {'x' : 13.71, 'y' : 123.44},	102 : {'x' : 41.15, 'y' : 123.44},
                    103 : {'x' : -82.29, 'y' : 96.00},	104 : {'x' : -54.86, 'y' : 96.00},
                    105 : {'x' : -27.43, 'y' : 96.00},	106 : {'x' : 0.00, 'y' : 96.00},
                    107 : {'x' : 27.43, 'y' : 96.00},	108 : {'x' : 54.86, 'y' : 96.00},
                    109 : {'x' : 82.29, 'y' : 96.00},	110 : {'x' : -109.72, 'y' : 68.58},
                    111 : {'x' : -82.29, 'y' : 68.58},	112 : {'x' : -54.86, 'y' : 68.58},
                    113 : {'x' : -27.43, 'y' : 68.58},	114 : {'x' : 0.00, 'y' : 68.58},
                    115 : {'x' : 27.43, 'y' : 68.58},	116 : {'x' : 54.86, 'y' : 68.58},
                    117 : {'x' : 82.29, 'y' : 68.58},	118 : {'x' : 109.72, 'y' : 68.58},
                    119 : {'x' : -123.44, 'y' : 41.15},	120 : {'x' : -96.00, 'y' : 41.15},
                    121 : {'x' : -68.58, 'y' : 41.15},	122 : {'x' : -41.15, 'y' : 41.15},
                    123 : {'x' : -13.71, 'y' : 41.15},	124 : {'x' : 13.71, 'y' : 41.15},
                    125 : {'x' : 41.15, 'y' : 41.15},	126 : {'x' : 68.58, 'y' : 41.15},
                    127 : {'x' : 96.00, 'y' : 41.15},	128 : {'x' : 123.44, 'y' : 41.15},
                    129 : {'x' : -123.44, 'y' : 13.71},	130 : {'x' : -96.00, 'y' : 13.71},
                    131 : {'x' : -68.58, 'y' : 13.71},	132 : {'x' : -41.15, 'y' : 13.71},
                    133 : {'x' : -13.71, 'y' : 13.71},	134 : {'x' : 13.71, 'y' : 13.71},
                    135 : {'x' : 41.15, 'y' : 13.71},	136 : {'x' : 68.58, 'y' : 13.71},
                    137 : {'x' : 96.00, 'y' : 13.71},	138 : {'x' : 123.44, 'y' : 13.71},
                    139 : {'x' : -123.44, 'y' : -13.71},	140 : {'x' : -96.00, 'y' : -13.71},
                    141 : {'x' : -68.58, 'y' : -13.71},	142 : {'x' : -41.15, 'y' : -13.71},
                    143 : {'x' : -13.71, 'y' : -13.71},	144 : {'x' : 13.71, 'y' : -13.71},
                    145 : {'x' : 41.15, 'y' : -13.71},	146 : {'x' : 68.58, 'y' : -13.71},
                    147 : {'x' : 96.00, 'y' : -13.71},	148 : {'x' : 123.44, 'y' : -13.71},
                    149 : {'x' : -123.44, 'y' : -41.15},	150 : {'x' : -96.00, 'y' : -41.15},
                    151 : {'x' : -68.58, 'y' : -41.15},	152 : {'x' : -41.15, 'y' : -41.15},
                    153 : {'x' : -13.71, 'y' : -41.15},	154 : {'x' : 13.71, 'y' : -41.15},
                    155 : {'x' : 41.15, 'y' : -41.15},	156 : {'x' : 68.58, 'y' : -41.15},
                    157 : {'x' : 96.00, 'y' : -41.15},	158 : {'x' : 123.44, 'y' : -41.15},
                    159 : {'x' : -109.72, 'y' : -68.58},	160 : {'x' : -82.29, 'y' : -68.58},
                    161 : {'x' : -54.86, 'y' : -68.58},	162 : {'x' : -27.43, 'y' : -68.58},
                    163 : {'x' : 0.00, 'y' : -68.58},	164 : {'x' : 27.43, 'y' : -68.58},
                    165 : {'x' : 54.86, 'y' : -68.58},	166 : {'x' : 82.29, 'y' : -68.58},
                    167 : {'x' : 109.72, 'y' : -68.58},	168 : {'x' : -82.29, 'y' : -96.00},
                    169 : {'x' : -54.86, 'y' : -96.00},	170 : {'x' : -27.43, 'y' : -96.00},
                    171 : {'x' : 0.00, 'y' : -96.00},	172 : {'x' : 27.43, 'y' : -96.00},
                    173 : {'x' : 54.86, 'y' : -96.00},	174 : {'x' : 82.29, 'y' : -96.00},
                    175 : {'x' : -41.15, 'y' : -123.44},	176 : {'x' : -13.71, 'y' : -123.44},
                    177 : {'x' : 13.71, 'y' : -123.44},	178 : {'x' : 41.15, 'y' : -123.44},
                    179 : {'x' : 197.15, 'y' : 0.00},	180 : {'x' : 193.53, 'y' : 37.62},
                    181 : {'x' : 182.79, 'y' : 73.85},	182 : {'x' : 165.34, 'y' : 107.38},
                    183 : {'x' : 139.41, 'y' : 139.41},	184 : {'x' : 110.25, 'y' : 163.44},
                    185 : {'x' : 77.03, 'y' : 181.48},	186 : {'x' : 40.99, 'y' : 192.84},
                    187 : {'x' : 0.00, 'y' : 197.15},	188 : {'x' : -37.62, 'y' : 193.53},
                    189 : {'x' : -73.85, 'y' : 182.79},	190 : {'x' : -107.38, 'y' : 165.34},
                    191 : {'x' : -139.41, 'y' : 139.41},	192 : {'x' : -163.44, 'y' : 110.25},
                    193 : {'x' : -181.48, 'y' : 77.03},	194 : {'x' : -192.84, 'y' : 40.99},
                    195 : {'x' : -197.15, 'y' : 0.00},	196 : {'x' : -193.53, 'y' : -37.62},
                    197 : {'x' : -182.79, 'y' : -73.85},	198 : {'x' : -165.34, 'y' : -107.38},
                    199 : {'x' : -139.41, 'y' : -139.41},	200 : {'x' : -110.25, 'y' : -163.44},
                    201 : {'x' : -77.03, 'y' : -181.48},	202 : {'x' : -40.99, 'y' : -192.84},
                    203 : {'x' : -0.00, 'y' : -197.15},	204 : {'x' : 37.62, 'y' : -193.53},
                    205 : {'x' : 73.85, 'y' : -182.79},	206 : {'x' : 107.38, 'y' : -165.34},
                    207 : {'x' : 139.41, 'y' : -139.41},	208 : {'x' : 163.44, 'y' : -110.25},
                    209 : {'x' : 181.48, 'y' : -77.03},	210 : {'x' : 192.84, 'y' : -40.99},
                    211 : {'x' : -197.15, 'y' : 0.00},	212 : {'x' : -193.53, 'y' : 37.62},
                    213 : {'x' : -182.79, 'y' : 73.85},	214 : {'x' : -165.34, 'y' : 107.38},
                    215 : {'x' : -139.41, 'y' : 139.41},	216 : {'x' : -110.25, 'y' : 163.44},
                    217 : {'x' : -77.03, 'y' : 181.48},	218 : {'x' : -40.99, 'y' : 192.84},
                    219 : {'x' : -0.00, 'y' : 197.15},	220 : {'x' : 37.62, 'y' : 193.53},
                    221 : {'x' : 73.85, 'y' : 182.79},	222 : {'x' : 107.38, 'y' : 165.34},
                    223 : {'x' : 139.41, 'y' : 139.41},	224 : {'x' : 163.44, 'y' : 110.25},
                    225 : {'x' : 181.48, 'y' : 77.03},	226 : {'x' : 192.84, 'y' : 40.99},
                    227 : {'x' : 197.15, 'y' : 0.00},	228 : {'x' : 193.53, 'y' : -37.62},
                    229 : {'x' : 182.79, 'y' : -73.85},	230 : {'x' : 165.34, 'y' : -107.38},
                    231 : {'x' : 139.41, 'y' : -139.41},	232 : {'x' : 110.25, 'y' : -163.44},
                    233 : {'x' : 77.03, 'y' : -181.48},	234 : {'x' : 40.99, 'y' : -192.84},
                    235 : {'x' : 0.00, 'y' : -197.15},	236 : {'x' : -37.62, 'y' : -193.53},
                    237 : {'x' : -73.85, 'y' : -182.79},	238 : {'x' : -107.38, 'y' : -165.34},
                    239 : {'x' : -139.41, 'y' : -139.41},	240 : {'x' : -163.44, 'y' : -110.25},
                    241 : {'x' : -181.48, 'y' : -77.03},	242 : {'x' : -192.84, 'y' : -40.99},
                    }



# A few of these gains are zero. It is assumed this was done intentionally;
# we won't consider signals in these channels at all.
# (JoinAndConvertWaveforms does not put them in channel_waveforms)
# The first real PMT is 1, that's how Xenon100 PMTs are numbered.
# DO NOT change this without updating the pmt top/bottom/veto/excluded lists!
# Jelle: I added channel 0 as a dead channel manually on 13-Aug-2014
gains = {0:0, 1: 2715400, 2: 2875650, 3: 1941550, 4: 2068200, 5: 1886150, 6: 1868400, 7: 2152300, 8: 1906050, 9: 0, 10: 2055000, 11: 1930250, 12: 0, 13: 1965000, 14: 2111900, 15: 2169650, 16: 2219450, 17: 2096400, 18: 2097900, 19: 2108850, 20: 2092000, 21: 1989150, 22: 2040950, 23: 1637300, 24: 1945750, 25: 2170050, 26: 2192580, 27: 1982450, 28: 1942100, 29: 2237050, 30: 2152150, 31: 2222250, 32: 2216050, 33: 1335300, 34: 2068850, 35: 2079500, 36: 2141900, 37: 2046050, 38: 2008500, 39: 0, 40: 2060950, 41: 1943350, 42: 1855350, 43: 2057200, 44: 2000850, 45: 1934950, 46: 2178750, 47: 2024650, 48: 2068700, 49: 2155750, 50: 2110050, 51: 2144400, 52: 1941400, 53: 2114150, 54: 2051850, 55: 2215000, 56: 2081950, 57: 2165650, 58: 0, 59: 2260550, 60: 2156850, 61: 2048350, 62: 2087100, 63: 1966400, 64: 2221700, 65: 2099600, 66: 2133950, 67: 2048450, 68: 2146666, 69: 2206800, 70: 2231100, 71: 2145450, 72: 2231700, 73: 2199000, 74: 2051600, 75: 1968400, 76: 2069050, 77: 1978400, 78: 1949900, 79: 2088250, 80: 2228600, 81: 2172150, 82: 1985350, 83: 2095200, 84: 1955900, 85: 1883350, 86: 1978250, 87: 2121750, 88: 1836000, 89: 2123250, 90: 2026111, 91: 2272600, 92: 2215750, 93: 2152050, 94: 1915650, 95: 1877750, 96: 2345450, 97: 2164900, 98: 1954600, 99: 1856200, 100: 0, 101: 1957500, 102: 2281000, 103: 1999400, 104: 1909750, 105: 0, 106: 1732550, 107: 2112500, 108: 1915900, 109: 2013850, 110: 2123900, 111: 1961950, 112: 1821350, 113: 1899500, 114: 1808000, 115: 2129950, 116: 2012450, 117: 1941950, 118: 2053850, 119: 2005100, 120: 1991250, 121: 1830500, 122: 1952150, 123: 2002750, 124: 2108100, 125: 1940100,
         126: 1954250, 127: 1969100, 128: 2188000, 129: 2142850, 130: 2057600, 131: 2209300, 132: 2144350, 133: 2033300, 134: 1932400, 135: 1966950, 136: 1973500, 137: 1897850, 138: 2088700, 139: 1663000, 140: 2242900, 141: 1717450, 142: 1956350, 143: 1894600, 144: 1898050, 145: 1677300, 146: 1996350, 147: 1811250, 148: 1672200, 149: 1890050, 150: 2103400, 151: 1672650, 152: 1969150, 153: 2161000, 154: 1774550, 155: 1932550, 156: 1813000, 157: 1938070, 158: 2020900, 159: 2047600, 160: 1821350, 161: 1791450, 162: 1720900, 163: 2051950, 164: 1903850, 165: 1801900, 166: 1995750, 167: 1550250, 168: 1200800, 169: 1896100, 170: 2005250, 171: 2022750, 172: 1835500, 173: 1922250, 174: 1948900, 175: 2090300, 176: 1910550, 177: 0, 178: 1831350, 179: 2012100, 180: 2074300, 181: 2502050, 182: 1339200, 183: 1814200, 184: 1895530, 185: 1975050, 186: 2047850, 187: 1946850, 188: 2144300, 189: 2000100, 190: 2017750, 191: 0, 192: 1942150, 193: 2117550, 194: 1529950, 195: 0, 196: 1923750, 197: 1749050, 198: 1940300, 199: 1971950, 200: 1919150, 201: 1888400, 202: 2184450, 203: 2163800, 204: 1983700, 205: 2010900, 206: 2055700, 207: 1984900, 208: 2045150, 209: 2132550, 210: 1791500, 211: 2050600, 212: 2000600, 213: 2039950, 214: 1831400, 215: 2035350, 216: 1759010, 217: 2062300, 218: 2111100, 219: 1945900, 220: 1973750, 221: 2177800, 222: 1914600, 223: 1981400, 224: 0, 225: 1994150, 226: 2069750, 227: 2201250, 228: 2069300, 229: 1964850, 230: 1938750, 231: 1972100, 232: 1869500, 233: 1995650, 234: 2149150, 235: 0, 236: 2113400, 237: 1804800, 238: 1921700, 239: 1805550, 240: 1898200, 241: 1893470, 242: 190140}


[BuildWaveforms.BuildWaveforms]
build_nominally_gain_corrected_waveforms = True
nominal_pmt_gain = 2.0* 10**6 #pe / e
baseline_sample_length = 46
reuse_baseline_for_adjacent_occurrences = True
rear_baselining_for_short_occurrences = True
rear_baselining_threshold_occurrence_length = 92

[Filtering.Filtering]
simulate_Xerawdp_convolution_bug = True
filters = (
        {'name' : 'filtered_for_large_s2',  'source' : 'uS2',  'impulse_response' : (
            0.005452,  0.009142,  0.013074,  0.017179,  0.021381,  0.025597,  0.029746,  0.033740,  0.037499,
            0.040941,  0.043992,  0.046586,  0.048666,  0.050185,  0.051111,  0.051422,  0.051111,  0.050185,
            0.048666,  0.046586,  0.043992,  0.040941,  0.037499,  0.033740,  0.029746,  0.025597,  0.021381,
            0.017179,  0.013074,  0.009142,  0.005452
        )},
        {'name' : 'filtered_for_small_s2',  'source' : 'uS2',  'impulse_response' : (
            0, 0.103, 0.371, 0.691, 0.933, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.933, 0.691, 0.371, 0.103, 0
        )},
        {'name' : 'filtered_for_s1_width_test',  'source' : 'uS1',  'impulse_response' : (
            0.005452,  0.009142,  0.013074,  0.017179,  0.021381,  0.025597,  0.029746,  0.033740,  0.037499,
            0.040941,  0.043992,  0.046586,  0.048666,  0.050185,  0.051111,  0.051422,  0.051111,  0.050185,
            0.048666,  0.046586,  0.043992,  0.040941,  0.037499,  0.033740,  0.029746,  0.025597,  0.021381,
            0.017179,  0.013074,  0.009142,  0.005452
        )},
    )

[WaveformSimulator]

# PMT characteristics
pmt_transit_time_mean     =           50  * ns           # PLACEHOLDER - PMT handbook upper limit for linear focussed pmt type
                                                         # Not a big issue I think, this merely shifts the entire waveform. Could even put it 0.
pmt_transit_time_spread   =           0.8 * ns           # xenon:xenon100:pmtdatasheets, Room temperature
pmt_rise_time             =           1.8 * ns           # xenon:xenon100:pmtdatasheets, Room temperature
pmt_fall_time             =           6.7 * ns           # PLACEHOLDER - Can't find this! Now chosen 3.7 * rise time, as for Lung et al. 2012 (X1T PMTs)
white_noise_sigma         =           0.5 * uA           # PLACEHOLDER - Sigma of Gaussian noise applied separately to every PMT that has seen a photon

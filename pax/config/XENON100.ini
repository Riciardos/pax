##
# XENON100-specific configuration settings
##


# This is just for setting up pax
[pax]
parent_configuration = "_base"    # Inherit settings from default.ini

# Digital signal processing to imitate Xerawdp
dsp = ['AssembleSignals.CutOverhangingPulses',
       'AssembleSignals.JoinAndConvertWaveforms',
       'AssembleSignals.SumWaveforms',
       'Filtering.LargeS2Filter', 'Filtering.SmallS2Filter', 'Filtering.S1WidthTestFilter',
       'PeakFinding.FindPeaksXeRawDPStyle',
       'PeakFinding.ComputePeakProperties',
       ]


# Global settings, passed to every plugin
[DEFAULT]
num_pmts = 242
tpc_name = "XENON100"

# Remember python range does not include endpoint!
# Remember python3 range does not return a list;
# have to encapsulate it in set() to be able to | these
# Could have used list and +, but easier to subtract excluded pmts this way
# This is pretty arcane python stuff to put in a config file...!
# TODO: There should be a more intelligent way to do this
pmts_top = set(range(1,  98 + 1))
pmts_bottom = set(range(99, 178 + 1))
pmts_veto = set(range(179, 242 + 1))

digitizer_t_resolution = 10 * ns
digitizer_voltage_range = 2.25 * V
digitizer_bits = 14
pmt_circuit_load_resistor = 50 * Ohm
external_amplification = 10

# The PMTs below are excluded when peakfinding and computing the areas/widths etc of S1s.
# This has no effect on S2s; the only way to fully disable a channel is to set its gain to 0.
#
# TEMP for XerawDP matching: we need the uncorrected waveform for peakfinding,
# which is only available in JoinAndConvertWaveforms, so it is computed there.
pmts_excluded_for_s1 = set([1, 2, 145, 148, 157, 171, 177])

# PMT locations taken from Marc Schumann's pmtpattern code.  Agrees also
# with the top PMT locations used by xerawdp.
pmt_locations = {0: {'x': 0.0, 'y': 0.0},
 1: {'x': -166.8, 'y': 0.0}, 2: {'x': -163.2, 'y': 34.7},
 3: {'x': -152.4, 'y': 67.9}, 4: {'x': -135.0, 'y': 98.1},
 5: {'x': -111.6, 'y': 124.0}, 6: {'x': -83.4, 'y': 144.5},
 7: {'x': -51.6, 'y': 158.7},
 8: {'x': -17.4, 'y': 165.9},
 9: {'x': 17.4, 'y': 165.9},
 10: {'x': 51.6, 'y': 158.7},
 11: {'x': 83.4, 'y': 144.5},
 12: {'x': 111.6, 'y': 124.0},
 13: {'x': 135.0, 'y': 98.1},
 14: {'x': 152.4, 'y': 67.9},
 15: {'x': 163.2, 'y': 34.7},
 16: {'x': 166.8, 'y': 0.0},
 17: {'x': 163.2, 'y': -34.7},
 18: {'x': 152.4, 'y': -67.9},
 19: {'x': 135.0, 'y': -98.1},
 20: {'x': 111.6, 'y': -124.0},
 21: {'x': 83.4, 'y': -144.5},
 22: {'x': 51.6, 'y': -158.7},
 23: {'x': 17.4, 'y': -165.9},
 24: {'x': -17.4, 'y': -165.9},
 25: {'x': -51.6, 'y': -158.7},
 26: {'x': -83.4, 'y': -144.5},
 27: {'x': -111.6, 'y': -124.0},
 28: {'x': -135.0, 'y': -98.1},
 29: {'x': -152.4, 'y': -67.9},
 30: {'x': -163.2, 'y': -34.7},
 31: {'x': -136.5, 'y': 0.0},
 32: {'x': -131.9, 'y': 35.3},
 33: {'x': -118.2, 'y': 68.3},
 34: {'x': -96.5, 'y': 96.5},
 35: {'x': -68.3, 'y': 118.2},
 36: {'x': -35.3, 'y': 131.9},
 37: {'x': -0.0, 'y': 136.5},
 38: {'x': 35.3, 'y': 131.9},
 39: {'x': 68.3, 'y': 118.2},
 40: {'x': 96.5, 'y': 96.5},
 41: {'x': 118.2, 'y': 68.3},
 42: {'x': 131.9, 'y': 35.3},
 43: {'x': 136.5, 'y': 0.0},
 44: {'x': 131.9, 'y': -35.3},
 45: {'x': 118.2, 'y': -68.3},
 46: {'x': 96.5, 'y': -96.5},
 47: {'x': 68.3, 'y': -118.2},
 48: {'x': 35.3, 'y': -131.9},
 49: {'x': 0.0, 'y': -136.5},
 50: {'x': -35.3, 'y': -131.9},
 51: {'x': -68.3, 'y': -118.2},
 52: {'x': -96.5, 'y': -96.5},
 53: {'x': -118.0, 'y': -68.3},
 54: {'x': -131.0, 'y': -35.3},
 55: {'x': -106.0, 'y': 0.0},
 56: {'x': -101.0, 'y': 32.8},
 57: {'x': -85.9, 'y': 62.4},
 58: {'x': -62.4, 'y': 85.9},
 59: {'x': -32.8, 'y': 101.0},
 60: {'x': -0.0, 'y': 106.2},
 61: {'x': 32.8, 'y': 101.0},
 62: {'x': 62.4, 'y': 85.9},
 63: {'x': 85.9, 'y': 62.4},
 64: {'x': 101.0, 'y': 32.8},
 65: {'x': 106.2, 'y': 0.0},
 66: {'x': 101.0, 'y': -32.8},
 67: {'x': 85.9, 'y': -62.4},
 68: {'x': 62.4, 'y': -85.9},
 69: {'x': 32.8, 'y': -101.0},
 70: {'x': 0.0, 'y': -106.2},
 71: {'x': -32.8, 'y': -101.0},
 72: {'x': -62.4, 'y': -85.9},
 73: {'x': -85.9, 'y': -62.4},
 74: {'x': -101.0, 'y': -32.8},
 75: {'x': -75.9, 'y': 0.0},
 76: {'x': -68.4, 'y': 32.9},
 77: {'x': -47.3, 'y': 59.3},
 78: {'x': -16.9, 'y': 74.0},
 79: {'x': 16.9, 'y': 74.0},
 80: {'x': 16.9, 'y': 74.2121},
 81: {'x': 68.4, 'y': 32.9},
 82: {'x': 75.9, 'y': 0.0},
 83: {'x': 68.4, 'y': -32.9},
 84: {'x': 47.3, 'y': -59.3},
 85: {'x': 16.9, 'y': -74.0},
 86: {'x': -16.9, 'y': -74.0},
 87: {'x': -47.3, 'y': -59.3},
 88: {'x': -68.4, 'y': -32.9},
 89: {'x': -45.0, 'y': 0.0},
 90: {'x': -30.0, 'y': 30.0},
 91: {'x': 0.0, 'y': 45.0},
 92: {'x': 30.0, 'y': 30.0},
 93: {'x': 45.0, 'y': 0.0},
 94: {'x': 30.0, 'y': -30.0},
 95: {'x': 0.0, 'y': -45.0},
 96: {'x': -30.0, 'y': -30.0},
 97: {'x': -15.0, 'y': 0.0},
 98: {'x': 15.0, 'y': 0.0},
 99: {'x': -41.145, 'y': 2.15435},
 100: {'x': -13.715, 'y': 2.15435},
 101: {'x': 13.715, 'y': 2.15435},
 102: {'x': 41.145, 'y': 2.15435},
 103: {'x': -82.29, 'y': 1.6756},
 104: {'x': -54.86, 'y': 1.6756},
 105: {'x': -27.43, 'y': 1.6756},
 106: {'x': 0.0, 'y': 1.6756},
 107: {'x': 27.43, 'y': 1.6756},
 108: {'x': 54.86, 'y': 1.6756},
 109: {'x': 82.29, 'y': 1.6756},
 110: {'x': -109.72, 'y': 1.19686},
 111: {'x': -82.29, 'y': 1.19686},
 112: {'x': -54.86, 'y': 1.19686},
 113: {'x': -27.43, 'y': 1.19686},
 114: {'x': 0.0, 'y': 1.19686},
 115: {'x': 27.43, 'y': 1.19686},
 116: {'x': 54.86, 'y': 1.19686},
 117: {'x': 82.29, 'y': 1.19686},
 118: {'x': 109.72, 'y': 1.19686},
 119: {'x': -123.435, 'y': 0.718116},
 120: {'x': -96.005, 'y': 0.718116},
 121: {'x': -68.575, 'y': 0.718116},
 122: {'x': -41.145, 'y': 0.718116},
 123: {'x': -13.715, 'y': 0.718116},
 124: {'x': 13.715, 'y': 0.718116},
 125: {'x': 41.145, 'y': 0.718116},
 126: {'x': 68.575, 'y': 0.718116},
 127: {'x': 96.005, 'y': 0.718116},
 128: {'x': 123.435, 'y': 0.718116},
 129: {'x': -123.435, 'y': 0.239372},
 130: {'x': -96.005, 'y': 0.239372},
 131: {'x': -68.575, 'y': 0.239372},
 132: {'x': -41.145, 'y': 0.239372},
 133: {'x': -13.715, 'y': 0.239372},
 134: {'x': 13.715, 'y': 0.239372},
 135: {'x': 41.145, 'y': 0.239372},
 136: {'x': 68.575, 'y': 0.239372},
 137: {'x': 96.005, 'y': 0.239372},
 138: {'x': 123.435, 'y': 0.239372},
 139: {'x': -123.435, 'y': -0.239372},
 140: {'x': -96.005, 'y': -0.239372},
 141: {'x': -68.575, 'y': -0.239372},
 142: {'x': -41.145, 'y': -0.239372},
 143: {'x': -13.715, 'y': -0.239372},
 144: {'x': 13.715, 'y': -0.239372},
 145: {'x': 41.145, 'y': -0.239372},
 146: {'x': 68.575, 'y': -0.239372},
 147: {'x': 96.005, 'y': -0.239372},
 148: {'x': 123.435, 'y': -0.239372},
 149: {'x': -123.435, 'y': -0.718116},
 150: {'x': -96.005, 'y': -0.718116},
 151: {'x': -68.575, 'y': -0.718116},
 152: {'x': -41.145, 'y': -0.718116},
 153: {'x': -13.715, 'y': -0.718116},
 154: {'x': 13.715, 'y': -0.718116},
 155: {'x': 41.145, 'y': -0.718116},
 156: {'x': 68.575, 'y': -0.718116},
 157: {'x': 96.005, 'y': -0.718116},
 158: {'x': 123.435, 'y': -0.718116},
 159: {'x': -109.72, 'y': -1.19686},
 160: {'x': -82.29, 'y': -1.19686},
 161: {'x': -54.86, 'y': -1.19686},
 162: {'x': -27.43, 'y': -1.19686},
 163: {'x': 0.0, 'y': -1.19686},
 164: {'x': 27.43, 'y': -1.19686},
 165: {'x': 54.86, 'y': -1.19686},
 166: {'x': 82.29, 'y': -1.19686},
 167: {'x': 109.72, 'y': -1.19686},
 168: {'x': -82.29, 'y': -1.6756},
 169: {'x': -54.86, 'y': -1.6756},
 170: {'x': -27.43, 'y': -1.6756},
 171: {'x': 0.0, 'y': -1.6756},
 172: {'x': 27.43, 'y': -1.6756},
 173: {'x': 54.86, 'y': -1.6756},
 174: {'x': 82.29, 'y': -1.6756},
 175: {'x': -41.145, 'y': -2.15435},
 176: {'x': -13.715, 'y': -2.15435},
 177: {'x': 13.715, 'y': -2.15435},
 178: {'x': 41.145, 'y': -2.15435},
 179: {'x': -197.15, 'y': 0.0},
 180: {'x': -193.528, 'y': 37.618},
 181: {'x': -182.794, 'y': 73.8537},
 182: {'x': -165.344, 'y': 107.376},
 183: {'x': -139.406, 'y': 139.406},
 184: {'x': -110.245, 'y': 163.445},
 185: {'x': -77.0326, 'y': 181.478},
 186: {'x': -40.9898, 'y': 192.842},
 187: {'x': 0, 'y': 197.15},
 188: {'x': 37.618, 'y': 193.528},
 189: {'x': 73.8537, 'y': 182.794},
 190: {'x': 107.376, 'y': 165.344},
 191: {'x': 139.406, 'y': 139.406},
 192: {'x': 163.445, 'y': 110.245},
 193: {'x': 181.478, 'y': 77.0326},
 194: {'x': 192.842, 'y': 40.9898},
 195: {'x': 197.15, 'y': 0},
 196: {'x': 193.528, 'y': -37.618},
 197: {'x': 182.794, 'y': -73.8537},
 198: {'x': 165.344, 'y': -107.376},
 199: {'x': 139.406, 'y': -139.406},
 200: {'x': 110.245, 'y': -163.445},
 201: {'x': 77.0326, 'y': -181.478},
 202: {'x': 40.9898, 'y': -192.842},
 203: {'x': 0, 'y': -197.15},
 204: {'x': -37.618, 'y': -193.528},
 205: {'x': -73.8537, 'y': -182.794},
 206: {'x': -107.376, 'y': -165.344},
 207: {'x': -139.406, 'y': -139.406},
 208: {'x': -163.445, 'y': -110.245},
 209: {'x': -181.478, 'y': -77.0326},
 210: {'x': -192.842, 'y': -40.9898},
 211: {'x': -197.15, 'y': 0.0},
 212: {'x': -193.528, 'y': 37.618},
 213: {'x': -182.794, 'y': 73.8537},
 214: {'x': -165.344, 'y': 107.376},
 215: {'x': -139.406, 'y': 139.406},
 216: {'x': -110.245, 'y': 163.445},
 217: {'x': -77.0326, 'y': 181.478},
 218: {'x': -40.9898, 'y': 192.842},
 219: {'x': 0, 'y': 197.15},
 220: {'x': 37.618, 'y': 193.528},
 221: {'x': 73.8537, 'y': 182.794},
 222: {'x': 107.376, 'y': 165.344},
 223: {'x': 139.406, 'y': 139.406},
 224: {'x': 163.445, 'y': 110.245},
 225: {'x': 181.478, 'y': 77.0326},
 226: {'x': 192.842, 'y': 40.9898},
 227: {'x': 197.15, 'y': 3.52858},
 228: {'x': 193.528, 'y': -37.618},
 229: {'x': 182.794, 'y': -73.8537},
 230: {'x': 165.344, 'y': -107.376},
 231: {'x': 139.406, 'y': -139.406},
 232: {'x': 110.245, 'y': -163.445},
 233: {'x': 77.0326, 'y': -181.478},
 234: {'x': 40.9898, 'y': -192.842},
 235: {'x': 0, 'y': -197.15},
 236: {'x': -37.618, 'y': -193.528},
 237: {'x': -73.8537, 'y': -182.794},
 238: {'x': -107.376, 'y': -165.344},
 239: {'x': -139.406, 'y': -139.406},
 240: {'x': -163.445, 'y': -110.245},
 241: {'x': -181.478, 'y': -77.0326},
 242: {'x': -192.842, 'y': -40.9898}}


# A few of these gains are zero. It is assumed this was done intentionally;
# we won't consider signals in these channels at all.
# (JoinAndConvertWaveforms does not put them in channel_waveforms)
# The first real PMT is 1, that's how Xenon100 PMTs are numbered.
# DO NOT change this without updating the pmt top/bottom/veto/excluded lists!
# Jelle: I added channel 0 as a dead channel manually on 13-Aug-2014
gains = {0:0, 1: 2715400, 2: 2875650, 3: 1941550, 4: 2068200, 5: 1886150, 6: 1868400, 7: 2152300, 8: 1906050, 9: 0, 10: 2055000, 11: 1930250, 12: 0, 13: 1965000, 14: 2111900, 15: 2169650, 16: 2219450, 17: 2096400, 18: 2097900, 19: 2108850, 20: 2092000, 21: 1989150, 22: 2040950, 23: 1637300, 24: 1945750, 25: 2170050, 26: 2192580, 27: 1982450, 28: 1942100, 29: 2237050, 30: 2152150, 31: 2222250, 32: 2216050, 33: 1335300, 34: 2068850, 35: 2079500, 36: 2141900, 37: 2046050, 38: 2008500, 39: 0, 40: 2060950, 41: 1943350, 42: 1855350, 43: 2057200, 44: 2000850, 45: 1934950, 46: 2178750, 47: 2024650, 48: 2068700, 49: 2155750, 50: 2110050, 51: 2144400, 52: 1941400, 53: 2114150, 54: 2051850, 55: 2215000, 56: 2081950, 57: 2165650, 58: 0, 59: 2260550, 60: 2156850, 61: 2048350, 62: 2087100, 63: 1966400, 64: 2221700, 65: 2099600, 66: 2133950, 67: 2048450, 68: 2146666, 69: 2206800, 70: 2231100, 71: 2145450, 72: 2231700, 73: 2199000, 74: 2051600, 75: 1968400, 76: 2069050, 77: 1978400, 78: 1949900, 79: 2088250, 80: 2228600, 81: 2172150, 82: 1985350, 83: 2095200, 84: 1955900, 85: 1883350, 86: 1978250, 87: 2121750, 88: 1836000, 89: 2123250, 90: 2026111, 91: 2272600, 92: 2215750, 93: 2152050, 94: 1915650, 95: 1877750, 96: 2345450, 97: 2164900, 98: 1954600, 99: 1856200, 100: 0, 101: 1957500, 102: 2281000, 103: 1999400, 104: 1909750, 105: 0, 106: 1732550, 107: 2112500, 108: 1915900, 109: 2013850, 110: 2123900, 111: 1961950, 112: 1821350, 113: 1899500, 114: 1808000, 115: 2129950, 116: 2012450, 117: 1941950, 118: 2053850, 119: 2005100, 120: 1991250, 121: 1830500, 122: 1952150, 123: 2002750, 124: 2108100, 125: 1940100,
         126: 1954250, 127: 1969100, 128: 2188000, 129: 2142850, 130: 2057600, 131: 2209300, 132: 2144350, 133: 2033300, 134: 1932400, 135: 1966950, 136: 1973500, 137: 1897850, 138: 2088700, 139: 1663000, 140: 2242900, 141: 1717450, 142: 1956350, 143: 1894600, 144: 1898050, 145: 1677300, 146: 1996350, 147: 1811250, 148: 1672200, 149: 1890050, 150: 2103400, 151: 1672650, 152: 1969150, 153: 2161000, 154: 1774550, 155: 1932550, 156: 1813000, 157: 1938070, 158: 2020900, 159: 2047600, 160: 1821350, 161: 1791450, 162: 1720900, 163: 2051950, 164: 1903850, 165: 1801900, 166: 1995750, 167: 1550250, 168: 1200800, 169: 1896100, 170: 2005250, 171: 2022750, 172: 1835500, 173: 1922250, 174: 1948900, 175: 2090300, 176: 1910550, 177: 0, 178: 1831350, 179: 2012100, 180: 2074300, 181: 2502050, 182: 1339200, 183: 1814200, 184: 1895530, 185: 1975050, 186: 2047850, 187: 1946850, 188: 2144300, 189: 2000100, 190: 2017750, 191: 0, 192: 1942150, 193: 2117550, 194: 1529950, 195: 0, 196: 1923750, 197: 1749050, 198: 1940300, 199: 1971950, 200: 1919150, 201: 1888400, 202: 2184450, 203: 2163800, 204: 1983700, 205: 2010900, 206: 2055700, 207: 1984900, 208: 2045150, 209: 2132550, 210: 1791500, 211: 2050600, 212: 2000600, 213: 2039950, 214: 1831400, 215: 2035350, 216: 1759010, 217: 2062300, 218: 2111100, 219: 1945900, 220: 1973750, 221: 2177800, 222: 1914600, 223: 1981400, 224: 0, 225: 1994150, 226: 2069750, 227: 2201250, 228: 2069300, 229: 1964850, 230: 1938750, 231: 1972100, 232: 1869500, 233: 1995650, 234: 2149150, 235: 0, 236: 2113400, 237: 1804800, 238: 1921700, 239: 1805550, 240: 1898200, 241: 1893470, 242: 190140}

# Option for all 3 Xerawdp-filters... have to put it here
simulate_Xerawdp_convolution_bug = True

[fax.FaX]

# Digitizer characeristics
digitizer_baseline = 16000

# PMT characteristics
pmt_transit_time_mean     =           50  * ns           # PLACEHOLDER - PMT handbook upper limit for linear focussed pmt type
                                                         # Not a big issue I think, this merely shifts the entire waveform. Could even put it 0.
pmt_transit_time_spread   =           0.8 * ns           # xenon:xenon100:pmtdatasheets, Room temperature
pmt_rise_time             =           1.8 * ns           # xenon:xenon100:pmtdatasheets, Room temperature
pmt_fall_time             =           6.7 * ns           # Can't find this! Now chosen 3.7 * fall time, as for Lung et al. 2012 (X1T PMTs)
white_noise_sigma         =           0.5 * uA           # Noise applied separately to every PMT that has seen a photon


# S1
s1_detection_efficiency   =           0   #TEMP  #0.08               # % photons detected, NSort
singlet_lifetime_liquid   =           3.1 * ns           # Nest 2014
triplet_lifetime_liquid   =           24 * ns            # Nest 2014
s1_default_primary_excimer_fraction = 1/(1+1/(0.06))     # THIS IS WRONG!!! Nest 2011: Nex/Ni=0.06 "theoretically" ... wait, but I want Nex_primary/Nex_tot, not Nex/Ni!!!
s1_default_recombination_time =       0  #TEMP  #     5 * ns             # PLACEHOLDER, \hat{\tau}=3.5ns, so reasonable?
s1_default_singlet_fraction =         0.697              # PLACEHOLDER.. ?

# S2 electron drift and extraction
electron_lifetime_liquid =            350 * us           # NSort? GPlante's thesis? Add proper ref!
drift_velocity_liquid     =           1.73*um/ns         # Andrea says 1.73 um/ns. Ethan's code has 1.8 mm/us.
drift_velocity_liquid_above_gate =    0.272*cm/us        # From the single electron paper
diffusion_constant_liquid =           12*cm**(2)/s       # Sorensen 2011, longitudinal diffusion. Ethan's code uses 70*cm**(2)/s! (0.007*mm**2/us)
electron_trapping_time    =           140*ns             # Nest 2014, but was obtained through fitting data
electron_extraction_yield =           1                  # "above 0.96" xenon:xenon100:analysis:maxime:s2afterpulses
gate_to_anode_distance =              5 * mm             # TODO: add ref
elr_gas_gap_length =                  2.5*mm             # Xenon100 Analysis paper, page 4, "h_g ~ 2.5 mm"

# S2 electroluminescence
s2_secondary_sc_yield_density =       19.7/(2.5*mm)      # "secondary scintillation gain" per length unit. 19.7 from NSort. This automatically includes detection efficiencies.
drift_velocity_gas        =           8*mm/us            # TODO: find a better value for this!
                                                         # Nest S2widthposter.pdf 'physically well motivated value' for Xenon10 (what is it for Xenon100?). They note 5 mm/us produced a better fit...
                                                         # Aprile & Bolotnikov have a plot on p.36, but it is in reduced field... need number density first... lazy
anode_wire_radius         =           125/2*um           # GPlante p 98
anode_mesh_pitch          =           2.5*mm             # GPlante p 98
wire_field_parameter      =           0.5                # field becomes wire-dominated (~1/r) at wire_field_parameter*anode_mesh_pitch
singlet_lifetime_gas      =           5.88*ns            # Nest 2014
triplet_lifetime_gas      =           100.1*ns           # Nest 2014
singlet_fraction_gas      =           0.697              # PLACEHOLDER... from Nest source code? what was it again?

[PosSimple.PosRecWeightedSum]

pmts_to_use_for_reconstruction = 'top'

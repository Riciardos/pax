{% extends "base.html" %}
{% block content %}
    <h5>Click and drag to zoom, double click to reset view</h5>
    <div id="plot" style="width:98%%;height:85%%"></div>                            
    
    <button id="merge">Save as png</button>
 <style type="text/css">
     .annos1 { color:red !important;}
     .annos2 { color:blue !important;}
     </style>
  <script>                                                                     
    var graph = null;
    $.getJSON('/get_waveform', function(data){
    
    graph = new Dygraph(plot, data['waveform'],{
    legend: 'always',                                                   
    title: 'sum waveform',                                                  
    showRoller: true,                                                   
    rollPeriod: 1,    
    labels: ["bin (10ns)", "sum_waveform"],
    ylabel: "charge times something",                                                     
    xlabel: "bin (10ns)",                     

    });                                                                      
   
    var annotations = [];
    for (i = 0; i < data['peaks'].length; i++){
        thiscss = "annos1";
        if(data['peaks'][i][0] == "s2")
            thiscss = "annos2";
	annotations.push( {
	    series: "sum_waveform",
	    x: data['peaks'][i][2],
	    shortText: data['peaks'][i][0]+'_'+data['peaks'][i][1],
            text: 'area: '+data['peaks'][i][3] + '  left: ' + data['peaks'][i][4] + '  right: ' + data['peaks'][i][5],
            cssClass: thiscss,
            tickHeight: 30,
            width: 50,
            clickHandler: function(canvas,area) {

            },
	});
    }
    graph.setAnnotations(annotations);
  });
    $("#merge").click(function() {
      var imgExport = document.createElement('imgExport');
      Dygraph.Export.asPNG(graph,imgExport);      
      window.location.href = imgExport.src.replace('image/png','image/octet-stream');
    });
    
        

</script>
{% endblock %}

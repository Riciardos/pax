<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Event builder &mdash; Processor for Analyzing XENON1T 4.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Processor for Analyzing XENON1T 4.1.0 documentation" href="index.html" />
    <link rel="next" title="Waveform simulator docs" href="simulator.html" />
    <link rel="prev" title="Plugins" href="plugin.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="event-builder">
<h1>Event builder<a class="headerlink" href="#event-builder" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-pax.eventbuilder">
<span id="core-routines"></span><h2>Core routines<a class="headerlink" href="#module-pax.eventbuilder" title="Permalink to this headline">¶</a></h2>
<p>Event builder routines</p>
<p>The event builder is responsible for finding events within the DAQ output
stream and turning this into events that the end user can process.  The data is
fetched untriggered, which means that there is no event structure.  Or rather,
it is just a stream of PMT pulses that need to be assembled into events.  This
is exactly what this code does.  There are two inputs requires:</p>
<ul class="simple">
<li>Location of runs database</li>
<li>Trigger settings</li>
</ul>
<dl class="docutils">
<dt>This code is meant to run in production, therefore a runs database must be</dt>
<dd>provided.  This code will use this database to locate what data needs to be
processed and handle it appropriately.</dd>
</dl>
<p>This code is also responsible triggering (i.e., deciding which events to
record).  At present there are two stages to the triggering: a pretrigger and
a pax-event trigger.  The pretrigger is a simple sliding window coincidence
trigger that runs over the data to identify possible signals.  The parameters
of this are then, clearly, the size of the window and the coincidence
requirement.  Another parameter is how much data to save around the discovered
peak, which often is an S2.</p>
<p>The second level trigger, which we often do not run, processed the event in pax
and is used to make, e.g., radial cuts.  At present, the code just writes HDF5
files.</p>
<p>It is worth mentioning that is an &#8216;expert modes&#8217; with a flag for mega events:
an event of one second is made that can be used for computing the trigger
efficiency.</p>
<p>The entry point to this code is typically via bin/event-builder.</p>
<dl class="function">
<dt id="pax.eventbuilder.authenticate">
<code class="descclassname">pax.eventbuilder.</code><code class="descname">authenticate</code><span class="sig-paren">(</span><em>client</em>, <em>database_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/eventbuilder.html#authenticate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.eventbuilder.authenticate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="pax.eventbuilder.handle_args">
<code class="descclassname">pax.eventbuilder.</code><code class="descname">handle_args</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/eventbuilder.html#handle_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.eventbuilder.handle_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Command line argument processing</p>
<p>This routine is also responsible for setting up logging.</p>
</dd></dl>

<dl class="function">
<dt id="pax.eventbuilder.run">
<code class="descclassname">pax.eventbuilder.</code><code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/eventbuilder.html#run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.eventbuilder.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Start running the event builder</p>
<p>Find a dataset to process, then process it with settings from command line.</p>
</dd></dl>

</div>
<div class="section" id="module-pax.plugins.io.MongoDB">
<span id="mongodb-interface"></span><h2>MongoDB interface<a class="headerlink" href="#module-pax.plugins.io.MongoDB" title="Permalink to this headline">¶</a></h2>
<p>Interfacing to MongoDB</p>
<p>MongoDB is used as a data backend within the DAQ.  For example, &#8216;kodiaq&#8217;, which
reads out the digitizers, will write data to MongoDB.  This data from kodiaq can
either be triggered or untriggered. In the case of untriggered, an event builder
must be run on the data and will result in triggered data.  Input and output
classes are provided for MongoDB access.  More information is in the docstrings.</p>
<dl class="class">
<dt id="pax.plugins.io.MongoDB.IOMongoDB">
<em class="property">class </em><code class="descclassname">pax.plugins.io.MongoDB.</code><code class="descname">IOMongoDB</code><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<dl class="staticmethod">
<dt id="pax.plugins.io.MongoDB.IOMongoDB.chunks">
<em class="property">static </em><code class="descname">chunks</code><span class="sig-paren">(</span><em>l</em>, <em>n</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB.chunks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB.chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield successive n-sized chunks from l.</p>
</dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.IOMongoDB.number_events">
<code class="descname">number_events</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB.number_events"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB.number_events" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.IOMongoDB.setup_access">
<code class="descname">setup_access</code><span class="sig-paren">(</span><em>name</em>, <em>address</em>, <em>database</em>, <em>collection</em>, <em>port=27017</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB.setup_access"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB.setup_access" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.IOMongoDB.setup_input">
<code class="descname">setup_input</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB.setup_input"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB.setup_input" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.IOMongoDB.shutdown">
<code class="descname">shutdown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB.shutdown"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB.shutdown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.IOMongoDB.startup">
<code class="descname">startup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB.startup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB.startup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.IOMongoDB.update_run_doc">
<code class="descname">update_run_doc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#IOMongoDB.update_run_doc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.IOMongoDB.update_run_doc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggered">
<em class="property">class </em><code class="descclassname">pax.plugins.io.MongoDB.</code><code class="descname">MongoDBReadUntriggered</code><span class="sig-paren">(</span><em>config_values</em>, <em>processor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggered"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggered" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="pax.html#pax.plugin.InputPlugin" title="pax.plugin.InputPlugin"><code class="xref py py-class docutils literal"><span class="pre">pax.plugin.InputPlugin</span></code></a>, <a class="reference internal" href="pax.plugins.io.html#pax.plugins.io.MongoDB.IOMongoDB" title="pax.plugins.io.MongoDB.IOMongoDB"><code class="xref py py-class docutils literal"><span class="pre">pax.plugins.io.MongoDB.IOMongoDB</span></code></a></p>
<p>Read from MongoDB and build events</p>
<p>This will perform a sliding window trigger on the times.  No PMT pulse
data is read in this class to ensure speed.</p>
<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggered.get_events">
<code class="descname">get_events</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggered.get_events"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggered.get_events" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggered.sliding_window">
<code class="descname">sliding_window</code><span class="sig-paren">(</span><em>x</em>, <em>n</em>, <em>window=1000</em>, <em>multiplicity=3</em>, <em>left=-10</em>, <em>right=7</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggered.sliding_window"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggered.sliding_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Sliding window cluster finder (with range extension)</p>
<p>x is a list of times.  A window will slide over the values in x and
this function will return all event ranges with more than &#8216;multiplicity&#8217;
of pulses.  We assume that any pulses will have ~1 pe area.
Also, left and right will be added to ranges, where left can be the
drift length.</p>
</dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggered.sliding_window2">
<code class="descname">sliding_window2</code><span class="sig-paren">(</span><em>x</em>, <em>ranges_buffer_size</em>, <em>window=1000</em>, <em>multiplicity=3</em>, <em>left=-10</em>, <em>right=7</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggered.sliding_window2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggered.sliding_window2" title="Permalink to this definition">¶</a></dt>
<dd><p>Sliding window cluster finder (with range extension)</p>
<p>x is a list of times.  A window will slide over the values in x and
this function will return all event ranges with more than &#8216;multiplicity&#8217;
of pulses.  We assume that any pulses will have ~1 pe area.
Also, left and right will be added to ranges, where left can be the
drift length.  n is the number of possible ranges.</p>
</dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggered.startup">
<code class="descname">startup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggered.startup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggered.startup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggeredFiller">
<em class="property">class </em><code class="descclassname">pax.plugins.io.MongoDB.</code><code class="descname">MongoDBReadUntriggeredFiller</code><span class="sig-paren">(</span><em>config_values</em>, <em>processor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggeredFiller"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggeredFiller" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="pax.html#pax.plugin.TransformPlugin" title="pax.plugin.TransformPlugin"><code class="xref py py-class docutils literal"><span class="pre">pax.plugin.TransformPlugin</span></code></a>, <a class="reference internal" href="pax.plugins.io.html#pax.plugins.io.MongoDB.IOMongoDB" title="pax.plugins.io.MongoDB.IOMongoDB"><code class="xref py py-class docutils literal"><span class="pre">pax.plugins.io.MongoDB.IOMongoDB</span></code></a></p>
<p>Read untriggered data from MongoDB into event classes</p>
<p>After MongoDBReadUntriggered has identified events, this class actually
reads out the raw data from MongoDB.  This is a separate class to ensure
that we can parallelize.</p>
<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggeredFiller.startup">
<code class="descname">startup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggeredFiller.startup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggeredFiller.startup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBReadUntriggeredFiller.transform_event">
<code class="descname">transform_event</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBReadUntriggeredFiller.transform_event"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBReadUntriggeredFiller.transform_event" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="pax.plugins.io.MongoDB.MongoDBWriteTriggered">
<em class="property">class </em><code class="descclassname">pax.plugins.io.MongoDB.</code><code class="descname">MongoDBWriteTriggered</code><span class="sig-paren">(</span><em>config_values</em>, <em>processor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBWriteTriggered"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBWriteTriggered" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="pax.html#pax.plugin.OutputPlugin" title="pax.plugin.OutputPlugin"><code class="xref py py-class docutils literal"><span class="pre">pax.plugin.OutputPlugin</span></code></a>, <a class="reference internal" href="pax.plugins.io.html#pax.plugins.io.MongoDB.IOMongoDB" title="pax.plugins.io.MongoDB.IOMongoDB"><code class="xref py py-class docutils literal"><span class="pre">pax.plugins.io.MongoDB.IOMongoDB</span></code></a></p>
<p>Write entire processed event to MongoDB</p>
<p>These events are already triggered.  We first convert event class to a dict,
then pymongo converts that to BSON.  We have to convert the numpy arrays to
bytes because otherwise we get type errors since pymongo doesn&#8217;t know about
numpy.</p>
<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBWriteTriggered.startup">
<code class="descname">startup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBWriteTriggered.startup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBWriteTriggered.startup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pax.plugins.io.MongoDB.MongoDBWriteTriggered.write_event">
<code class="descname">write_event</code><span class="sig-paren">(</span><em>event_class</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#MongoDBWriteTriggered.write_event"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.MongoDBWriteTriggered.write_event" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="pax.plugins.io.MongoDB.sampletime_fmt">
<code class="descclassname">pax.plugins.io.MongoDB.</code><code class="descname">sampletime_fmt</code><span class="sig-paren">(</span><em>num</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pax/plugins/io/MongoDB.html#sampletime_fmt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pax.plugins.io.MongoDB.sampletime_fmt" title="Permalink to this definition">¶</a></dt>
<dd><p>num is in 1s of ns</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Event builder</a><ul>
<li><a class="reference internal" href="#module-pax.eventbuilder">Core routines</a></li>
<li><a class="reference internal" href="#module-pax.plugins.io.MongoDB">MongoDB interface</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="plugin.html" title="previous chapter">Plugins</a></li>
      <li>Next: <a href="simulator.html" title="next chapter">Waveform simulator docs</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/eventbuilder.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, Christopher Tunnell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/eventbuilder.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>